apiVersion: v1
kind: Pod
metadata:
  name: h-kim-dev
  namespace: nccl-test
  labels:
    app: h-kim
spec:
  restartPolicy: Always

  nodeSelector:
    nvidia.com/gpu.present: "true"

  tolerations:
  - key: nvidia.com/gpu
    operator: Exists
    effect: NoSchedule

  containers:
  - name: h-kim
    image: image-registry.openshift-image-registry.svc:5000/nccl-test/h-kim:latest
    imagePullPolicy: Always

    resources:
      requests:
        nvidia.com/gpu: 4
        memory: 128Gi
        cpu: 32
      limits:
        nvidia.com/gpu: 4
        memory: 256Gi
        cpu: 64

    env:
    - name: NVIDIA_VISIBLE_DEVICES
      value: "all"
    - name: NVIDIA_DRIVER_CAPABILITIES
      value: "compute,utility"

    volumeMounts:
    - name: workspace
      mountPath: /workspace
    - name: dshm
      mountPath: /dev/shm

    command: ["/bin/bash", "-c", "sleep infinity"]

  volumes:
  - name: workspace
    persistentVolumeClaim:
      claimName: ml-dev-workspace
  - name: dshm
    emptyDir:
      medium: Memory
      sizeLimit: 32Gi
