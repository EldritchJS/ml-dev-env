# Multi-Node NCCL AllReduce Benchmark Results
# Date: 2026-02-27
# Nodes: moc-r4pcc04u25-nairr + moc-r4pcc04u36-nairr  
# GPUs: 8× H100-80GB (4 per node)
# NICs: 8× ConnectX-7 400G (4 per node)
# NCCL Plugin: IBext_v8
# Firmware: OPTIMIZED (u36 firmware fixed to match u25)

# Format: size(MB)   tavg(usec)    tmin(usec)    tmax(usec)  avgbw(GB/sec)  maxbw(GB/sec)  minbw(GB/sec)

    0.10      194.1          173.3          455.8          0.90           1.01           0.38
    0.12      234.9          172.8         2845.3          0.89           1.22           0.07
    0.15      211.1          182.4         1127.3          1.24           1.44           0.23
    0.20      238.0          192.5         1640.0          1.47           1.82           0.21
    0.32      256.2          202.0         2125.3          2.19           2.77           0.26
    0.40      294.7          232.6         1626.7          2.38           3.01           0.43
    0.50      332.8          270.6         1519.4          2.63           3.23           0.58
    0.64      323.9          268.3         1576.5          3.46           4.17           0.71
    0.80      382.7          270.9         4905.4          3.66           5.17           0.29
    1.00      328.3          267.4         1385.4          5.33           6.54           1.26
    1.25      329.0          275.7         1587.9          6.65           7.93           1.38
    1.50      372.2          284.9         3665.7          7.05           9.21           0.72
    2.00      330.5          279.1         1448.9         10.59          12.54           2.42
    3.16      325.3          288.2         1441.1         17.00          19.18           3.84
    4.00      324.1          289.2         1332.9         21.60          24.20           5.25
    5.00      339.8          277.3         1421.8         25.75          31.56           6.15
    6.40      343.5          292.0         1522.5         32.60          38.35           7.36
    8.00      335.3          293.4         1415.5         41.75          47.72           9.89
   10.00      329.8          311.0          351.1         53.07          56.27          49.85
   12.50      381.6          323.4         1278.8         57.32          67.63          17.11
   15.00      376.1          314.5         1118.2         69.80          83.47          23.48
   20.00      351.7          332.7          374.5         99.52         105.20          93.47
   31.60      417.0          392.9          454.0        132.60         140.74         121.82
   40.00      500.8          469.1          540.8        139.77         149.22         129.43
   50.00      623.2          550.9         1127.8        140.41         158.83          77.58
   64.00      734.7          685.7         1141.7        152.43         163.33          98.10
   80.00      851.3          809.2          883.6        164.46         173.00         158.44
  100.00     1029.3          996.1         1073.4        170.01         175.69         163.03
  125.00     1259.9         1219.6         1306.3        173.63         179.36         167.45
  160.00     1578.4         1536.0         1648.7        177.40         182.29         169.83
  200.00     1940.5         1902.4         1974.4        180.37         183.98         177.27
  250.00     2420.7         2369.6         2716.0        180.73         184.63         161.08
  316.00     3006.6         2978.3         3036.7        183.93         185.67         182.10
  400.00     3950.4         3719.7         7109.5        177.20         188.18          98.46
  500.00     4719.6         4620.2         4832.1        185.40         189.39         181.08
  640.00     6061.0         5924.6         6731.8        184.79         189.04         166.38
  800.00     7413.8         7283.6         7553.1        188.84         192.21         185.35
 1000.00     9211.3         9170.4         9257.1        189.98         190.83         189.04
 1250.00    11458.5        11379.4        11566.5        190.91         192.23         189.12
 1600.00    14597.4        14551.2        14639.5        191.82         192.42         191.26
 2000.00    18245.4        18102.2        18352.4        191.83         193.35         190.71
 2500.00    22671.8        22582.8        22815.0        192.97         193.73         191.76
 3160.00    28833.8        28515.3        29465.7        191.79         193.93         187.68
 4000.00    36238.0        36083.5        36501.8        193.17         193.99         191.77
 5000.00    45218.7        45035.9        45644.5        193.50         194.29         191.70
 6400.00    57614.2        57512.6        57734.7        194.40         194.74         193.99
 8000.00    72033.0        71842.1        72227.1        194.36         194.87         193.83

# SUMMARY
# ========
# Peak Bandwidth: 194.87 GB/s (max)
# Sustained Bandwidth (large messages): ~194 GB/s
# Target Performance: 194.23 GB/s (historical) ✅ ACHIEVED

# KEY FIXES THAT ENABLED THIS PERFORMANCE:
# 1. Fixed NCCL_IB_HCA hardcoding issue - let NCCL auto-detect from NCCL_SOCKET_IFNAME
# 2. Firmware optimization on moc-r4pcc04u36-nairr:
#    - ADVANCED_PCI_SETTINGS: False → True
#    - MAX_ACC_OUT_READ: 0 → 128
#    - PCI_WR_ORDERING: Mixed → per_mkey
# 3. IBext_v8 RDMA plugin with GPU Direct RDMA enabled
